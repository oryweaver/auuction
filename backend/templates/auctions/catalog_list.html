{% extends "auctions/base.html" %}
{% block title %}Catalog{% endblock %}
{% block subtitle %}Browse items by category{% endblock %}
{% block content %}
  <form role="search" method="get" action="" style="display:flex; gap:.5rem; align-items:center; max-width:640px; margin:.25rem 0 1rem;">
    <input type="search" name="q" placeholder="Search by title, description, or category" value="{{ q|default:'' }}" aria-label="Search catalog" style="flex:1; padding:.4rem .6rem; font-size:.95rem; border-radius:.375rem; height:auto;">
    <button type="submit" style="padding:.45rem .8rem; font-size:.9rem; line-height:1; border-radius:.375rem; white-space:nowrap;">Search</button>
  </form>
  {% if q %}
    <p style="margin-top:.25rem; color:#555;">Results for <strong>“{{ q }}”</strong>{% if results_count is not None %}: {{ results_count }} item{% if results_count != 1 %}s{% endif %}{% endif %}. <a href="{% url 'auctions:catalog_list' %}">Clear</a></p>
  {% endif %}
  
  {% for cat in categories %}
    <section class="category">
      <details open>
        <summary style="cursor:pointer;">
          <h2 id="{{ cat.slug }}" style="display:inline;">{{ cat.name }}</h2>
          <span style="color:#666; margin-left:.5rem;">({{ cat.published_items|length|default:0 }})</span>
        </summary>
        {% if cat.published_items %}
          <div class="grid" style="margin-top:.75rem;">
            {% for item in cat.published_items %}
              <article class="item-card">
                {% if item.image %}
                  <a href="{% url 'auctions:item_detail' slug=item.slug %}">
                    <img src="{{ item.image.url }}" alt="{{ item.title }}" style="max-width:140px; max-height:140px; width:auto; height:auto; object-fit:cover; display:block; margin-bottom:.5rem;">
                  </a>
                {% endif %}
                <header><h3><a href="{% url 'auctions:item_detail' slug=item.slug %}">{{ item.title }}</a></h3></header>
                <p>{{ item.description|truncatechars:140 }}</p>
                {% if item.buy_now_price %}<p><strong>Buy Now:</strong> ${{ item.buy_now_price }}</p>{% endif %}
              </article>
            {% endfor %}
          </div>
        {% else %}
          <p style="margin-top:.5rem;"><em>No items published in this category yet.</em></p>
        {% endif %}
      </details>
    </section>
  {% empty %}
    {% if q %}
      <p style="margin-top:1rem;"><em>No results found for “{{ q }}”.</em> <a href="{% url 'auctions:catalog_list' %}">Clear search</a></p>
    {% endif %}
  {% endfor %}
{% endblock %}
